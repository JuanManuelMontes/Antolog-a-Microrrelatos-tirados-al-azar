<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dado de la Suerte — 6 microrrelatos</title>
<meta name="color-scheme" content="dark light">
<style>
  :root{
    --bg:#0b0f17;
    --fg:#eaf2ff;
    --muted:#9fb2d9;
    --btn:#1d5cff;
    --btn-hover:#1647c8;
    --card:#121826;
    --edge:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; min-height:100dvh; display:grid; place-items:center;
    background:
      radial-gradient(1200px 700px at 10% -10%, #15203a 0%, transparent 60%),
      radial-gradient(1200px 700px at 110% 110%, #0e1526 0%, transparent 60%),
      var(--bg);
    color:var(--fg);
    font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  .app{ width:min(1080px,94vw); display:grid; gap:28px; padding:28px; }
  header h1{margin:0 0 4px; font-weight:800; letter-spacing:.3px}
  header p{margin:0; color:var(--muted)}
  .stage{ display:grid; grid-template-columns:1fr 1fr; gap:28px; align-items:start; }
  @media (max-width:880px){ .stage{ grid-template-columns:1fr } }

  .dice-wrap{
    display:grid; gap:16px; place-items:center; padding:18px;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
    border-radius:16px; outline:1px solid var(--edge);
    margin-bottom: 6em;
  }
  .viewport{
  width:min(360px,74vw);
  aspect-ratio:1/1;
  perspective:1100px;
  display:grid;
  place-items:center;
  position:relative;
  transform: scale(0.8); /* Reducido 20% */
}
  .shadow{ position:absolute; bottom:2%; width:70%; height:12%; background:radial-gradient(50% 60% at 50% 50%, rgba(0,0,0,.55), rgba(0,0,0,0) 70%); filter:blur(4px); pointer-events:none; }
  .dice{
    width:77%; height:77%;
    position:relative; transform-style:preserve-3d;
    transition:transform 1.05s cubic-bezier(.2,.7,.1,1); will-change:transform;
  }
  .face{
    position:absolute; inset:0;
    background:radial-gradient(160% 120% at 50% 20%, #2b3a63 0%, #1f2a47 55%, #141b2d 100%);
    border-radius:22px; display:grid; place-items:center;
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.05), inset 0 25px 60px rgba(255,255,255,.08), 0 24px 60px rgba(0,0,0,.55);
  }
  .face::after{
    content:""; position:absolute; inset:-1px; border-radius:22px;
    background:linear-gradient(to bottom right, rgba(255,255,255,.10), rgba(255,255,255,0) 30%), radial-gradient(80% 60% at 30% 10%, rgba(255,255,255,.15), transparent 60%);
    mix-blend-mode:screen; pointer-events:none;
  }
  .edge{ position:absolute; inset:0; border-radius:22px; box-shadow:0 0 0 2px rgba(255,255,255,.05); pointer-events:none; }
  
  .pips {
    width: 64%; height: 64%;
    display: grid;
    grid-template-columns: repeat(3, 1fr); 
    grid-template-rows: repeat(3, 1fr); 
    gap: 10%;
  }
  
  .logo-img {
    width: 64%; height: 64%;
    display: none;
    place-items: center;
    transform: translateY(-2rem);
  }
  
  .logo-img img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: block;
  }

  .pip {
    width:18px; height:18px; border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #fff 0%, #dfe6ff 35%, #b7c7ff 70%, #8ea3ff 100%);
    justify-self:center; align-self:center; box-shadow:0 2px 6px rgba(0,0,0,.35); display:none;
  }
  .pip:nth-child(1){ grid-area:1/1; } .pip:nth-child(2){ grid-area:1/2; } .pip:nth-child(3){ grid-area:1/3; }
  .pip:nth-child(4){ grid-area:2/1; } .pip:nth-child(5){ grid-area:2/2; } .pip:nth-child(6){ grid-area:2/3; }
  .pip:nth-child(7){ grid-area:3/1; } .pip:nth-child(8){ grid-area:3/2; } .pip:nth-child(9){ grid-area:3/3; }

  .face[data-n="1"] .pip:nth-child(5),
  .face[data-n="2"] .pip:nth-child(3), .face[data-n="2"] .pip:nth-child(7),
  .face[data-n="3"] .pip:nth-child(3), .face[data-n="3"] .pip:nth-child(5), .face[data-n="3"] .pip:nth-child(7),
  .face[data-n="4"] .pip:nth-child(1), .face[data-n="4"] .pip:nth-child(3), .face[data-n="4"] .pip:nth-child(7), .face[data-n="4"] .pip:nth-child(9),
  .face[data-n="5"] .pip:nth-child(1), .face[data-n="5"] .pip:nth-child(3), .face[data-n="5"] .pip:nth-child(5), .face[data-n="5"] .pip:nth-child(7), .face[data-n="5"] .pip:nth-child(9),
  .face[data-n="6"] .pip:nth-child(1), .face[data-n="6"] .pip:nth-child(3), .face[data-n="6"] .pip:nth-child(4), .face[data-n="6"] .pip:nth-child(6), .face[data-n="6"] .pip:nth-child(7), .face[data-n="6"] .pip:nth-child(9)
  { display:block }
  
  .face[data-n="6"] .pips { display: none; }
  .face[data-n="6"] .logo-img { display: grid; }

  .face,[data-n]{ transform-style:preserve-3d }
  .face[data-n="1"]{ transform: translateZ(136px) }
.face[data-n="2"]{ transform: rotateY(90deg) translateZ(136px) }
.face[data-n="3"]{ transform: rotateY(180deg) translateZ(136px) }
.face[data-n="4"]{ transform: rotateY(-90deg) translateZ(136px) }
.face[data-n="5"]{ transform: rotateX(90deg) translateZ(136px) }
.face[data-n="6"]{ transform: rotateX(-90deg) translateZ(136px) }


  .controls{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }
  button{
    appearance:none; border:0; cursor:pointer;
    background:linear-gradient(180deg, var(--btn), var(--btn-hover));
    color:#fff; padding:12px 18px; border-radius:12px; font-weight:800;
    letter-spacing:.3px; box-shadow:0 8px 20px rgba(29,92,255,.35);
  }
  button:disabled{opacity:.6; cursor:not-allowed; box-shadow:none}
  .muted{ background:#24304a; color:#d6e1ff; box-shadow:none; font-weight:700 }

  .card{ background:var(--card); border:1px solid var(--edge); border-radius:16px; padding:20px; min-height:300px; }
  .badge{ display:inline-grid; place-items:center; width:28px; height:28px; border-radius:8px; background:#1e2a45; color:#9fc1ff; font-weight:800; margin-right:8px; border:1px solid var(--edge); }
  h2{margin:0 0 6px; font-size:1.15rem}
  .author{color:var(--muted); margin:0 0 14px}

  .text p{
    color:#eef3ff;
    line-height:1.7;
    text-align: justify;
    text-indent: 40px;
    margin: 0 0 1em;
  }

  .small{font-size:.875rem}
  footer{color:var(--muted); font-size:.875rem; text-align:center}
</style>
</head>
<body>
  <main class="app" role="main">
    <header>
      <h1>Dado de la Suerte</h1>
      <p>Haz clic en el botón y deja que el azar te regale un texto. También puedes presionar <strong>R</strong> o sacudir el móvil.</p>
    </header>

    <section class="stage" aria-label="Juego de azar">
      <div class="dice-wrap">
        <div class="viewport" aria-hidden="true">
          <div class="shadow"></div>
          <div class="dice" id="dice">
            <div class="face" data-n="1"><span class="edge"></span><div class="pips">
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face" data-n="2"><span class="edge"></span><div class="pips">
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face" data-n="3"><span class="edge"></span><div class="pips">
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face" data-n="4"><span class="edge"></span><div class="pips">
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face" data-n="5"><span class="edge"></span><div class="pips">
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              <div class="pip"></div><div class="pip"></div><div class="pip"></div>
            </div></div>
            <div class="face" data-n="6"><span class="edge"></span>
              <div class="pips">
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
                <div class="pip"></div><div class="pip"></div><div class="pip"></div>
              </div>
              <div class="logo-img">
                <img src="Logo triple C.jpeg" alt="Logo Triple C">
              </div>
            </div>
          </div>
        </div>
        <div class="controls">
          <button id="rollBtn" aria-label="Lanzar el dado">Que la suerte te acompañe</button>
          <button id="imgBtn" class="muted" disabled>Descargar imagen (IG)</button>
        </div>
      </div>

      <article class="card" id="card" aria-live="polite">
        <div class="small" style="margin-bottom:6px; color:var(--muted);">Resultado</div>
        <h2><span class="badge" id="badge">—</span><span id="title">Aún no has tirado el dado</span></h2>
        <p class="author" id="author">Cuando salga un número, verás aquí el texto correspondiente.</p>
        <div class="text" id="content"></div>
      </article>
    </section>

    <footer>© 2025 — Triple C · Que la suerte te acompañe</footer>
  </main>

<script>
/* —— Textos —— */
const pieces = [
  { n:1, title:"LA FORTUNA", author:"PABLO GONZ", text:
`¿Quieres saber qué es la fortuna sin levantarte del sillón? Pues existe un método pero comporta cierto riesgo. Toma un dado grande. ¿Lo tienes? Si no lo tienes, suspende la lectura. ¿Ya tienes el dado? Bien, métetelo en la boca y cierra los labios. Mírate a un espejo y constata que pareces una persona normal. ¿OK? Estás preparado para empezar el ejercicio. Mueve la cabeza suavemente a la derecha y después a la izquierda. Luego repite el gesto seis veces, con mayor violencia cada vez. Si no se te rompe ningún diente, eso es la fortuna.` },

  { n:2, title:"RESUMEN URGENTE", author:"PATRICIA NASELLO", text:
`Apuesta, incluso, lo que le resulta imprescindible y cuando lo imprescindible se acaba, en cuanta covacha ilegal halla, apuesta lo ajeno. Una vez inmerso en esa fuerza que lo succiona, descubre que retener el trabajo, así como a la familia, es una tarea titánica para su energía ya escasa. Ahora, da vueltas dentro de un remolino sobre cuyas rocas punzantes del fondo, hasta el buen nombre pierde.
Y falta poco para que este mal que le arrebata el ánimo se extienda, e infecte con violencia la poca sangre libre de tormento que aún le resta.` },

  { n:3, title:"AZAR", author:"LEO MERCADO", text:
`Estuvo toda la noche perdiendo guita en la ruleta. Toda la noche, sin excepción, como desde hacía mucho tiempo no pasaba. Solitario y sin corazonadas, apostaba a números inservibles o imaginarios y perdía. Cuando se le acabó el último centavo salió del garito enfurecido y veloz y se topó con ella, que tenía unos ojos infinitos, mirándolo fijamente. Pero como venía con la racha del perdedor tampoco se dio cuenta y siguió de largo.` },

  { n:4, title:"LUDOPATÍA", author:"LORENA CITÓN", text:
`Cuando el psicólogo informó su diagnóstico, negó suavemente con la cabeza, suspiró y con calma inquietante le dijo:
- Apuesto a que estás equivocado` },

  { n:5, title:"SUERTE", author:"GUILLERMO IGLESIAS", text:
`Ella tan profesional independiente, tan discreto Chanel o lo que sea. Tan Kerouac que imaginate, y alguna Pizarnik aunque me mate Tan Las Palabras y la Cosas y lento pinot gris oxigenado. Uno tan cerveza en palangana, tan bestia choripán que no se note. Ella departiendo amablemente y uno tan perdiéndose en su escote. Ella tanto cello en la penumbra y uno BB King alcoholizado. Ella  tan mirá si no es divino inclinada sobre el tiesto señalado y uno sí, precioso y redondito (nunca logra mirar hacia otro lado) .Tan no puede funcionar hacete cargo y sigue funcionando, sin embargo.` },

  { n:6, title:"Triple C (Cofradía del Cuento Corto)", author:"QUE LA SUERTE TE ACOMPAÑE (microrrelatos tirados al azar)", text: "" }
];
const byN = Object.fromEntries(pieces.map(p=>[p.n,p]));

/* —— DOM —— */
const dice = document.getElementById('dice');
const rollBtn = document.getElementById('rollBtn');
const imgBtn = document.getElementById('imgBtn');
const badge = document.getElementById('badge');
const titleEl = document.getElementById('title');
const authorEl = document.getElementById('author');
const contentEl = document.getElementById('content');
const faces = document.querySelectorAll('.face');

let isRolling = false;
let lastN = 0;

/* —— Dado —— */
function randomFace(){ let n = Math.floor(Math.random()*6)+1; if(n===lastN) n = (n % 6) + 1; return n; }
function baseOrientation(n){
  switch(n){
    case 1: return 'rotateX(0deg) rotateY(0deg)';
    case 2: return 'rotateY(-90deg)';
    case 3: return 'rotateY(-180deg)';
    case 4: return 'rotateY(90deg)';
    case 5: return 'rotateX(-90deg)';
    case 6: return 'rotateX(90deg)';
  }
}
function spinTo(n){
  const turnsY = 360 * (2 + Math.floor(Math.random()*2));
  const turnsX = 360 * (1 + Math.floor(Math.random()*2));
  dice.style.transition = 'transform 1.05s cubic-bezier(.2,.7,.1,1)';
  dice.style.transform = `rotateX(${turnsX}deg) rotateY(${turnsY}deg) ${baseOrientation(n)}`;
}
function reveal(n){
  const p = byN[n];
  badge.textContent = n;
  titleEl.textContent = p.title;
  authorEl.textContent = p.author;
  
  if (n === 6) {
    contentEl.innerHTML = `<img src="Logo triple C.jpeg" alt="Logo Triple C" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">`;
  } else {
    contentEl.innerHTML = p.text
      .split(/\n+/)
      .map(par => `<p>${par}</p>`)
      .join('');
  }
  imgBtn.disabled = false;
}
function roll(){
  if(isRolling) return;
  isRolling = true;
  rollBtn.disabled = true; imgBtn.disabled = true;
  const n = randomFace(); 
  lastN = n; 
  spinTo(n);
  
  faces.forEach(face => {
      face.setAttribute('data-n', face.getAttribute('data-n'));
  });

  setTimeout(()=>{ reveal(n); isRolling = false; rollBtn.disabled = false; }, 1100);
}

/* --- Funciones para generar la imagen --- */
function wrapParagraph(ctx, text, maxWidth){
  const words = text.split(/\s+/);
  const lines = [];
  let line = '';
  for(const w of words){
    const test = line ? line + ' ' + w : w;
    if(ctx.measureText(test).width <= maxWidth){
      line = test;
    }else{
      if(line) lines.push(line);
      line = w;
    }
  }
  if(line) lines.push(line);
  return lines.map((t,i)=>({ text:t, first:i===0, last:i===lines.length-1 }));
}
function drawJustifiedLine(ctx, text, x, y, width){
  const words = text.split(/\s+/);
  if(words.length <= 1){ ctx.fillText(text, x, y); return; }
  const totalWordsWidth = words.reduce((acc,w)=> acc + ctx.measureText(w).width, 0);
  const gaps = words.length - 1;
  const spaceWidth = ctx.measureText(' ').width;
  const extra = (width - totalWordsWidth - spaceWidth*gaps) / gaps;
  let xx = x;
  for(let i=0;i<words.length;i++){
    const w = words[i];
    ctx.fillText(w, xx, y);
    if(i<gaps) xx += ctx.measureText(w).width + spaceWidth + Math.max(extra,0);
  }
}
async function renderImageFor(p){
    const W=1080, H=1350, PAD=96;
    const canvas = document.createElement('canvas');
    canvas.width=W;
    canvas.height=H;
    const ctx = canvas.getContext('2d');
    
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#0f1730');
    g.addColorStop(.6,'#121b36');
    g.addColorStop(1,'#0b0f17');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);
    ctx.strokeStyle = 'rgba(255,255,255,.08)';
    ctx.lineWidth = 4;
    ctx.strokeRect(2,2,W-4,H-4);

    return new Promise((resolve, reject) => {
        if (p.n === 6) {
            const img = new Image();
            img.crossOrigin = 'Anonymous';
            img.onload = () => {
                const imgWidth = 800;
                const imgHeight = (img.height / img.width) * imgWidth;
                const x = (W - imgWidth) / 2;
                const y = (H - imgHeight) / 2 - 76;
                ctx.drawImage(img, x, y, imgWidth, imgHeight);

                const footer = 'Triple C · Que la suerte te acompañe';
                ctx.font = `600 28px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial`;
                ctx.fillStyle = 'rgba(255,255,255,.55)';
                const fw = ctx.measureText(footer).width;
                ctx.fillText(footer, W - PAD - fw, H - PAD * 0.6);
                
                canvas.toBlob(blob => resolve(blob), 'image/png');
            };
            img.onerror = () => reject(new Error("Error al cargar la imagen del logo."));
            img.src = "Logo triple C.jpeg";
        } else {
            let titleSize=64, authorSize=38, bodySize=44;
            const family='system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial';
            const INDENT = 40;
            const X=PAD, CW=W-PAD*2; 
            let y=PAD;
            
            ctx.fillStyle='#eaf2ff'; ctx.font=`700 ${titleSize}px ${family}`;
            const titleLines = wrapParagraph(ctx, p.title, CW);
            for(const L of titleLines){ ctx.fillText(L.text, X, y+titleSize); y += titleSize*1.15; }
            
            y += 18; 
            ctx.fillStyle='#9fb2d9'; ctx.font=`600 ${authorSize}px ${family}`;
            ctx.fillText(p.author.toUpperCase(), X, y+authorSize); y += authorSize*1.35;
            
            ctx.fillStyle='#eef3ff';
            let linesMeta;
            while(true){
              ctx.font=`400 ${bodySize}px ${family}`;
              linesMeta = [];
              for(const para of p.text.split(/\n+/)){
                const ls = wrapParagraph(ctx, para, CW - INDENT);
                linesMeta.push(...ls, { text:'', first:false, last:true, isGap:true });
              }
              if(linesMeta.length && linesMeta[linesMeta.length-1].isGap) linesMeta.pop();
              const needed = y + linesMeta.reduce((acc,l)=> acc + (l.isGap ? bodySize*0.7 : bodySize*1.35), 0) + PAD;
              if(needed <= H || bodySize <= 28) break;
              bodySize -= 2;
            }
            
            for(const L of linesMeta){
              if(L.isGap){ y += bodySize*0.7; continue; }
              const x0 = X + (L.first ? INDENT : 0);
              const usable = CW - (L.first ? INDENT : 0);
              const yLine = y + bodySize;
              if(!L.last && L.text.includes(' ')){
                drawJustifiedLine(ctx, L.text, x0, yLine, usable);
              }else{
                ctx.fillText(L.text, x0, yLine);
              }
              y += bodySize*1.35;
            }
            
            const footer='Triple C · Que la suerte te acompañe';
            ctx.font=`600 28px ${family}`; ctx.fillStyle='rgba(255,255,255,.55)';
            const fw=ctx.measureText(footer).width; ctx.fillText(footer, W-PAD-fw, H-PAD*0.6);
            
            canvas.toBlob(blob => resolve(blob), 'image/png');
        }
    });
}
async function saveImage(){
    const p = byN[lastN];
    if(!p) return;
    try {
        const blob = await renderImageFor(p);
        if(blob){
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const safeTitle = p.title.replace(/[^\w\-]+/g,'_');
            a.href = url;
            a.download = p.n === 6 ? 'Triple_C_Logo.png' : `${safeTitle}.png`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        } else {
            console.error("No se pudo generar la imagen para descargar.");
        }
    } catch (error) {
        console.error("Error al generar la imagen: ", error);
    }
}

/* —— Eventos —— */
const diceEl = document.getElementById('dice');
rollBtn.addEventListener('click', roll);
document.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='r') roll(); });
imgBtn.addEventListener('click', saveImage);

// Sacudir móvil (Android)
let lastShake=0;
if('DeviceMotionEvent' in window){
  window.addEventListener('devicemotion', (e)=>{
    const a=e.accelerationIncludingGravity; if(!a) return;
    const intensity=Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z);
    const now=Date.now();
    if(intensity>35 && now-lastShake>1200){ lastShake=now; roll(); }
  }, {passive:true});
}
</script>
</body>
</html>
